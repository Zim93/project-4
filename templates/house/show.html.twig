{% extends 'base.html.twig' %}

{% block title %}House{% endblock %}

{% block body %}
    <style>
        #map {
        height: 400px;
        }
    </style>
    <link rel="stylesheet" href="/raty-master/lib/jquery.raty.css">
    <h1>House</h1>

    <input id="disabled-date" type="hidden" data-dates="{{to_disable | json_encode}}" />
    <input id="enabled-date" type="hidden" data-dates="{{to_enable | json_encode}}" />

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ house.id }}</td>
            </tr>
            <tr>
                <th>Name</th>
                <td>{{ house.name }}</td>
            </tr>
            <tr>
                <th>Type</th>
                <td>{{ house.type }}</td>
            </tr>
            <tr>
                <th>Full_address</th>
                <td>{{ house.fullAddress }}</td>
            </tr>
            <tr>
                <th>Street_number</th>
                <td>{{ house.streetNumber }}</td>
            </tr>
            <tr>
                <th>Street_sub_number</th>
                <td>{{ house.streetSubNumber }}</td>
            </tr>
            <tr>
                <th>Street_label</th>
                <td>{{ house.streetLabel }}</td>
            </tr>
            <tr>
                <th>City_name</th>
                <td>{{ house.cityName }}</td>
            </tr>
            <tr>
                <th>Postal_code</th>
                <td>{{ house.postalCode }}</td>
            </tr>
            <tr>
                <th>Nbr_accepted</th>
                <td>{{ house.nbrAccepted }}</td>
            </tr>
            <tr>
                <th>Nbr_beds</th>
                <td>{{ house.nbrBeds }}</td>
            </tr>
            <tr>
                <th>Nbr_rooms</th>
                <td>{{ house.nbrRooms }}</td>
            </tr>
            <tr>
                <th>Nbr_showeroom</th>
                <td>{{ house.nbrShoweroom }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ house.description }}</td>
            </tr>
            <tr>
                <th>Price</th>
                
                <td >{{ house.price }}</td>
            </tr>
            <tr>
                <th>note</th>
                
                <td class="rating-comment" data-note="{{ house.note }}"></td>
            </tr>
            {% if favorite is defined%}
             <tr>
                <th>Favori</th>
                {% if  favorite == true %}
                <td ><span class="btn btn-success add-to-favorite" data-id={{house.id}}>Favori</span></td>
                {% else %}
                <td ><span class="btn btn-secondary add-to-favorite" data-id={{house.id}}>Favori</span></td>
                {% endif %}
            </tr>
            {% endif %}
            <tr>
                <th>Equiments</th>
                <td>
                    {% for equiment in house.equiments %}
                        {{ equiment }} </br>
                    {% endfor %}
                </td>
            </tr>
        </tbody>
    </table>
    <div class="for_map" data-id={{house.id}}>
        <div class="price-pop">{{ house.price }}</div>
        <input type="hidden" class="pos" data-pos="lat" value="{{house.lat}}" />
        <input type="hidden" class="pos" data-pos="lng" value="{{house.lng}}" />
    </div>
    
    <div>
        {% for image in house.attachments %}
        <img src="/images/houses/{{image.url}}" height="200px" width="auto" />
        {% endfor %}
    </div>
    
    <div>
        <a href="{{ path('app_house_edit', {'id': house.id}) }}">edit</a>
        {{ include('house/_delete_form.html.twig') }}
    </div>
    <a href="{{ path('app_house_index') }}">back to list</a>

    
    <div class="w-50">
        {{ form_start(form_reservation, {'action':'/reservation/new'}) }}
            {{ form_row(form_reservation.nbr_voyagers) }}
            <div id="date-picker">
                <input id="reservation_start_date" name="start_date" autoComplete="off"/>
                <input id="reservation_end_date" name="end_date" autoComplete="off"/>
            </div>
            <input type="hidden" name="house" value="{{house.id}}"/>
            <button class="btn btn-warning">{{ button_label|default('Save') }}</button>
        {{ form_end(form_reservation)}}
    </div>


    <div id="map"></div>
    <script src="/raty-master/lib/jquery.raty.js"></script>
    <script>
    $(document).ready(function(){

        const score = parseFloat($($('.rating-comment')).data('note'));

        $(".rating-comment").raty({
            starOff:'/raty-master/lib/images/star-off.png',
            starOn:'/raty-master/lib/images/star-on.png',
            starHalf:'/raty-master/lib/images/star-half.png',
            half: true,
            readOnly: true, 
            score: score
        });

        $('.add-to-favorite').click(function(){
            const id = $('.add-to-favorite').data('id');
            const currentUrl = window.location.origin;
            
            $.ajax({
                    url: currentUrl+'/house/'+id+'/favorite',
                    method:'get'
            }).done(function(res){
                if(res.action == 'added'){
                    $('.add-to-favorite').removeClass('btn-secondary');
                    $('.add-to-favorite').addClass('btn-success');
                }else{
                    $('.add-to-favorite').removeClass('btn-success');
                    $('.add-to-favorite').addClass('btn-secondary');
                }
            }).fail(function(res){
                console.log(res);
            });
        })
    })

    </script>
{% endblock %}
